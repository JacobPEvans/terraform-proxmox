# Proxmox Configuration Example
# Copy this file to terraform.tfvars and customize for your environment

# Proxmox API Configuration
proxmox_api_endpoint = "https://your-proxmox-server.local:8006/api2/json"
proxmox_api_token    = "terraform@pve!terraform=your-api-token-here"
proxmox_insecure     = true

# Proxmox Node Configuration
proxmox_node     = "pve"
proxmox_username = "proxmox"

# SSH Configuration for Proxmox Host
proxmox_ssh_username    = "root@pam"
proxmox_ssh_private_key = "~/.ssh/id_rsa_pve"

# SSH Configuration for VMs
# These paths should point to your VM SSH keys
vm_ssh_public_key_path  = "~/.ssh/id_rsa_vm.pub"
vm_ssh_private_key_path = "~/.ssh/id_rsa_vm"

# Environment
environment = "homelab"

# Cloud-init configuration (use .local.yml for real deployment)
ansible_cloud_init_file = "cloud-init/ansible-server-example.yml"

# ISO Configuration
proxmox_iso_debian         = "debian-13.2.0-amd64-netinst.iso"
proxmox_ct_template_debian = "debian-13-standard_13.2-1_amd64.tar.zst"

# Firewall Configuration
management_network     = "192.168.1.0/24"
splunk_network         = ["192.168.1.199", "192.168.1.200"]
splunk_network_gateway = "192.168.1.1"

# Internal networks allowed to access Splunk (SSH, Web UI, forwarding port 9997)
# Default includes all RFC1918: ["10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16"]
# Override in terraform.tfvars (gitignored) with your actual internal networks
internal_networks = ["10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16"]

# Resource Pools
pools = {
  "logging" = {
    comment = "Logging and observability infrastructure"
  }
  "ai" = {
    comment = "AI development environments"
  }
  "infrastructure" = {
    comment = "Core infrastructure services"
  }
}

# Splunk VM Module Configuration - Single All-in-One (200+)
splunk_vm_id            = 200
splunk_vm_name          = "splunk-vm"
splunk_vm_pool_id       = "logging"
template_id             = 9200  # Packer-built Splunk template
splunk_boot_disk_size   = 25    # Boot disk: 25GB for OS and Splunk application
splunk_data_disk_size   = 200   # Data disk: 200GB for index storage

# VM Definitions - Generic VMs (empty, Splunk uses dedicated module above)
vms = {}

# Container Definitions
# ID Scheme:
#   100-109: Infrastructure services (Ansible, Pi-Hole, DNS)
#   110-119: Meta/Proxmox infrastructure (PVE scripts, bare metal helpers)
#   150-169: AI development
#   171-179: Cribl Stream
#   181-189: Cribl Edge
#   190-199: Splunk management
containers = {
  # Infrastructure Services (100-109)
  "ansible" = {
    vm_id            = 100
    hostname         = "ansible"
    description      = "Ansible control node - primary"
    cpu_cores        = 2
    memory_dedicated = 2048
    memory_swap      = 512
    tags             = ["terraform", "ansible", "control-plane", "container"]
    pool_id          = "infrastructure"

    root_disk = {
      datastore_id = "local-zfs"
      size         = 64
    }

    network_interfaces = [{
      name     = "eth0"
      bridge   = "vmbr0"
      firewall = true
    }]

    ip_config = {
      ipv4_address = "192.168.1.100/24"
      ipv4_gateway = "192.168.1.1"
    }
  }

  "ansible-2" = {
    vm_id            = 101
    hostname         = "ansible-2"
    description      = "Ansible control node - secondary"
    cpu_cores        = 2
    memory_dedicated = 2048
    memory_swap      = 512
    tags             = ["terraform", "ansible", "control-plane", "container"]
    pool_id          = "infrastructure"

    root_disk = {
      datastore_id = "local-zfs"
      size         = 64
    }

    network_interfaces = [{
      name     = "eth0"
      bridge   = "vmbr0"
      firewall = true
    }]

    ip_config = {
      ipv4_address = "192.168.1.101/24"
      ipv4_gateway = "192.168.1.1"
    }
  }

  "pi-hole" = {
    vm_id            = 104
    hostname         = "pi-hole"
    description      = "Pi-Hole DNS server and ad blocker"
    cpu_cores        = 1
    memory_dedicated = 512
    memory_swap      = 1536
    tags             = ["terraform", "infrastructure", "dns", "ad-blocker", "container"]
    pool_id          = "infrastructure"

    root_disk = {
      datastore_id = "local-zfs"
      size         = 16
    }

    network_interfaces = [{
      name     = "eth0"
      bridge   = "vmbr0"
      firewall = true
    }]

    ip_config = {
      ipv4_address = "192.168.1.104/24"
      ipv4_gateway = "192.168.1.1"
    }
  }

  # Meta/Proxmox Infrastructure (110-119)
  # NOTE: Container 110 may be created externally by community-scripts.
  # If it already exists, either import it or comment out this definition.
  "pve-scripts-local" = {
    vm_id            = 110
    hostname         = "pve-scripts-local"
    description      = "Proxmox VE Helper Scripts (community-scripts/ProxmoxVE)"
    cpu_cores        = 1
    memory_dedicated = 512
    memory_swap      = 512
    tags             = ["terraform", "proxmox", "helper-scripts", "meta", "container"]
    pool_id          = "infrastructure"

    root_disk = {
      datastore_id = "local-zfs"
      size         = 8
    }

    network_interfaces = [{
      name     = "eth0"
      bridge   = "vmbr0"
      firewall = false
    }]

    ip_config = {
      ipv4_address = "192.168.1.110/24"
      ipv4_gateway = "192.168.1.1"
    }
  }

  # AI Development (150-169)
  "claude-code-01" = {
    vm_id            = 150
    hostname         = "claude-code-01"
    description      = "Claude Code development environment 1"
    cpu_cores        = 2
    memory_dedicated = 2048
    memory_swap      = 512
    tags             = ["terraform", "ai", "claude", "development", "container"]
    pool_id          = "ai"

    root_disk = {
      datastore_id = "local-zfs"
      size         = 64
    }

    network_interfaces = [{
      name     = "eth0"
      bridge   = "vmbr0"
      firewall = true
    }]

    ip_config = {
      ipv4_address = "192.168.1.150/24"
      ipv4_gateway = "192.168.1.1"
    }
  }

  "claude-code-02" = {
    vm_id            = 151
    hostname         = "claude-code-02"
    description      = "Claude Code development environment 2"
    cpu_cores        = 2
    memory_dedicated = 2048
    memory_swap      = 512
    tags             = ["terraform", "ai", "claude", "development", "container"]
    pool_id          = "ai"

    root_disk = {
      datastore_id = "local-zfs"
      size         = 64
    }

    network_interfaces = [{
      name     = "eth0"
      bridge   = "vmbr0"
      firewall = true
    }]

    ip_config = {
      ipv4_address = "192.168.1.151/24"
      ipv4_gateway = "192.168.1.1"
    }
  }

  "gemini-01" = {
    vm_id            = 161
    hostname         = "gemini-01"
    description      = "Gemini development environment 1"
    cpu_cores        = 2
    memory_dedicated = 2048
    memory_swap      = 512
    tags             = ["terraform", "ai", "gemini", "development", "container"]
    pool_id          = "ai"

    root_disk = {
      datastore_id = "local-zfs"
      size         = 64
    }

    network_interfaces = [{
      name     = "eth0"
      bridge   = "vmbr0"
      firewall = true
    }]

    ip_config = {
      ipv4_address = "192.168.1.161/24"
      ipv4_gateway = "192.168.1.1"
    }
  }

  "gemini-02" = {
    vm_id            = 162
    hostname         = "gemini-02"
    description      = "Gemini development environment 2"
    cpu_cores        = 2
    memory_dedicated = 2048
    memory_swap      = 512
    tags             = ["terraform", "ai", "gemini", "development", "container"]
    pool_id          = "ai"

    root_disk = {
      datastore_id = "local-zfs"
      size         = 64
    }

    network_interfaces = [{
      name     = "eth0"
      bridge   = "vmbr0"
      firewall = true
    }]

    ip_config = {
      ipv4_address = "192.168.1.162/24"
      ipv4_gateway = "192.168.1.1"
    }
  }

  # Cribl Stream (171-179)
  "cribl-stream-1" = {
    vm_id            = 171
    hostname         = "cribl-stream-1"
    description      = "Cribl Stream processing node 1"
    cpu_cores        = 2
    memory_dedicated = 2048
    memory_swap      = 512
    tags             = ["terraform", "cribl", "stream", "log-processing", "container"]
    pool_id          = "logging"

    root_disk = {
      datastore_id = "local-zfs"
      size         = 32
    }

    # Persistent queue storage for Cribl data
    mount_points = [{
      volume = "local-zfs"
      size   = "100G"
      path   = "/opt/cribl/data"
    }]

    network_interfaces = [{
      name     = "eth0"
      bridge   = "vmbr0"
      firewall = true
    }]

    ip_config = {
      ipv4_address = "192.168.1.171/24"
      ipv4_gateway = "192.168.1.1"
    }
  }

  "cribl-stream-2" = {
    vm_id            = 172
    hostname         = "cribl-stream-2"
    description      = "Cribl Stream processing node 2"
    cpu_cores        = 2
    memory_dedicated = 2048
    memory_swap      = 512
    tags             = ["terraform", "cribl", "stream", "log-processing", "container"]
    pool_id          = "logging"

    root_disk = {
      datastore_id = "local-zfs"
      size         = 32
    }

    # Persistent queue storage for Cribl data
    mount_points = [{
      volume = "local-zfs"
      size   = "100G"
      path   = "/opt/cribl/data"
    }]

    network_interfaces = [{
      name     = "eth0"
      bridge   = "vmbr0"
      firewall = true
    }]

    ip_config = {
      ipv4_address = "192.168.1.172/24"
      ipv4_gateway = "192.168.1.1"
    }
  }

  # Cribl Edge (181-189)
  "cribl-edge-01" = {
    vm_id            = 181
    hostname         = "cribl-edge-01"
    description      = "Cribl Edge log forwarder 1"
    cpu_cores        = 2
    memory_dedicated = 2048
    memory_swap      = 512
    tags             = ["terraform", "cribl", "edge", "log-forwarding", "container"]
    pool_id          = "logging"

    root_disk = {
      datastore_id = "local-zfs"
      size         = 32
    }

    # Persistent queue storage for Cribl data
    mount_points = [{
      volume = "local-zfs"
      size   = "100G"
      path   = "/opt/cribl/data"
    }]

    network_interfaces = [{
      name     = "eth0"
      bridge   = "vmbr0"
      firewall = true
    }]

    ip_config = {
      ipv4_address = "192.168.1.181/24"
      ipv4_gateway = "192.168.1.1"
    }
  }

  "cribl-edge-02" = {
    vm_id            = 182
    hostname         = "cribl-edge-02"
    description      = "Cribl Edge log forwarder 2"
    cpu_cores        = 2
    memory_dedicated = 2048
    memory_swap      = 512
    tags             = ["terraform", "cribl", "edge", "log-forwarding", "container"]
    pool_id          = "logging"

    root_disk = {
      datastore_id = "local-zfs"
      size         = 32
    }

    # Persistent queue storage for Cribl data
    mount_points = [{
      volume = "local-zfs"
      size   = "100G"
      path   = "/opt/cribl/data"
    }]

    network_interfaces = [{
      name     = "eth0"
      bridge   = "vmbr0"
      firewall = true
    }]

    ip_config = {
      ipv4_address = "192.168.1.182/24"
      ipv4_gateway = "192.168.1.1"
    }
  }

  # Load Balancer & Syslog (190-199)
  "haproxy-syslog" = {
    vm_id            = 190
    hostname         = "haproxy-syslog"
    description      = "HAProxy load balancer and syslog server"
    cpu_cores        = 1
    memory_dedicated = 512
    memory_swap      = 512
    tags             = ["terraform", "haproxy", "load-balancer", "syslog", "container"]
    pool_id          = "logging"

    root_disk = {
      datastore_id = "local-zfs"
      size         = 16
    }

    network_interfaces = [{
      name     = "eth0"
      bridge   = "vmbr0"
      firewall = true
    }]

    ip_config = {
      ipv4_address = "192.168.1.190/24"
      ipv4_gateway = "192.168.1.1"
    }
  }

  # Splunk Management (190-199)
  "splunk-mgmt" = {
    vm_id            = 199
    hostname         = "splunk-mgmt"
    description      = "Splunk Management - Search Head, Deployment Server, License Manager, MC, Cluster Manager"
    cpu_cores        = 3
    memory_dedicated = 3072
    memory_swap      = 1024
    tags             = ["terraform", "splunk", "management", "container"]
    pool_id          = "logging"

    root_disk = {
      datastore_id = "local-zfs"
      size         = 100
    }

    network_interfaces = [{
      name     = "eth0"
      bridge   = "vmbr0"
      firewall = true
    }]

    ip_config = {
      ipv4_address = "192.168.1.199/24"
      ipv4_gateway = "192.168.1.1"
    }
  }
}

# Storage Configuration (optional - uses defaults)
datastores = {}
